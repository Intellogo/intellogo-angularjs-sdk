"use strict";angular.module("intellogoSDK",["ngResource"]).config(["$httpProvider",function(a){a.interceptors.push("AuthInterceptor")}]).run(["$rootScope","INTELLOGO_EVENTS","AuthService",function(a,b,c){a.$on(b.AUTHENTICATE_PASSWORD,function(a,b,d,e){c.loginWithPassword(b,d,e)}),a.$on(b.AUTHENTICATE_CLIENT_SECRET,function(){c.loginWithClientCredentials()}),a.$on(b.LOGOUT,function(){c.logout()}),window.hasOwnProperty("TEST_MODE")&&window.TEST_MODE||c.initializeRefresh()}]).config(["$provide",function(a){a.decorator("$q",["$delegate",function(a){var b=a.defer;return a.defer=function(){var a=b();return a.promise.success=function(b){return a.promise.then(_.ary(b,1)),a.promise},a.promise.error=function(b){return a.promise.then(null,_.ary(b,1)),a.promise},a},a}])}]),function(){angular.module("intellogoSDK").constant("LOG_AUTH_DATA",!1).constant("INTELLOGO_API_LOCATION","https://production.intellogo.com").provider("API_LOCATION",function(){this.$get=["$injector","$log",function(a,b){return b.warn("API_LOCATION is deprecated. Use ServiceUtils for URL construction instead"),a.get("INTELLOGO_API_LOCATION")}]})}(),angular.module("intellogoSDK").filter("intellogoSourceLink",function(){return function(a){function b(a){return!!_.isString(a)&&a.match(/^https?:\/\//)}function c(a,c){var d=b(c);return"Wikipedia"===a?"https://en.wikipedia.org/?curid="+c:"Project Gutenberg"===a?"https://www.gutenberg.org/ebooks/"+c:0===a.indexOf("Scribd",0)?"https://www.scribd.com/read/"+c:d?c:""}var d=a.metadata;return d&&d.source?c(d.source,d.sourceId):""}}),angular.module("intellogoSDK").constant("INTELLOGO_EVENTS",{AUTHENTICATE_PASSWORD:"event:authenticatePassword",AUTHENTICATE_CLIENT_SECRET:"event:authenticateClientSecret",AUTHENTICATION_FAILURE:"event:authenticationFailure",AUTHENTICATION_SUCCESS:"event:authenticationSuccess",LOGOUT:"event:logout",SMART_FOLDER_ADDED:"event:smartFolderAdded",SMART_FOLDER_UPDATED:"event:smartFolderUpdated",CATEGORY_UPDATED:"event:categoryUpdated"}),angular.module("intellogoSDK").factory("AuthService",["$rootScope","$http","$window","$timeout","$injector","TokenHandler","IntellogoCredentials","API_LOCATION","LOG_AUTH_DATA","INTELLOGO_EVENTS",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){g.setClientCredentials(a,b)}function l(){return g.getOauthClientId()}function m(){return g.getOauthClientSecret()}function n(b,c){i&&console.log("recv ",b),f.setToken(b.access_token),f.setRefreshToken(b.refresh_token);var d=b.expires_in,e=(new Date).getTime()+1e3*d;f.setTokenExpiration(e),u(),c&&a.$broadcast(j.AUTHENTICATION_SUCCESS)}function o(a){var d=c.$.param(a);return b.post(h+"/oauth/revoke",d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function p(a){i&&console.log("send",a);var d=c.$.param(a);return b.post(h+"/oauth/token",d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function q(){function b(a){console.error(a),alert("Your session has expired ! Please reload the page")}var c=f.getRefreshToken();if(!c)return console.log("No refresh token available."),void a.$broadcast(j.LOGOUT);var d={grant_type:"refresh_token",client_id:l(),client_secret:m(),refresh_token:c};p(d).success(function(a,c){c<200||c>299?b("Could not get a refresh token. Probably there is a communication problem with the server?"):n(a)}).error(b)}function r(b,c,d){function e(b,c,d){a.$broadcast(j.AUTHENTICATION_FAILURE,b,c,d)}var f={username:b,password:c,grant_type:"password",client_id:l(),client_secret:m()};d&&(f.forceLogin=d),p(f).error(function(a,b){e(a,b,f)}).success(function(a,b){b<200||b>299?e("Could not log you in. Probably there is a communication problem with the server?"):n(a,!0)})}function s(){function b(b){a.$broadcast(j.AUTHENTICATION_FAILURE,b)}var c={grant_type:"client_credentials",client_id:l(),client_secret:m()};p(c).error(b).success(function(a,c){c<200||c>299?b("Could not log you in. Probably there is a communication problem with the server?"):n(a,!0)})}function t(){var a={tokenToRevoke:f.getToken()};f.resetTokens();var b="Logout unsuccessful !";o(a).error(_.partial(alert,b)).success(function(a,c){(c<200||c>299)&&console.error(b)})}function u(){var b=30,c=(new Date).getTime(),e=f.getTokenExpiration(),g=e-1e3*b;if(f.getToken()){if(w&&d.cancel(w),!e||c>=g)return console.log("Access token expired."),void a.$broadcast(j.LOGOUT);console.log("Token valid until "+new Date(e)+". Will refresh it at "+new Date(g));var h=g-c;w=d(function(){console.log("Initiating token renewal. "+new Date),q()},h)}}function v(){return f.getTokenExpiration()>(new Date).getTime()}var w;return{setClientCredentials:k,loginWithPassword:r,loginWithClientCredentials:s,logout:t,initializeRefresh:u,refresh:q,isLoggedIn:v}}]),angular.module("intellogoSDK").factory("CaptionsService",["$http","API_LOCATION",function(a,b){function c(){return a.get(b+"/api/captions/channels")}function d(c){var d={source:"Youtube",channelId:c.id};return a.post(b+"/api/contents/delete",{metadataFilter:d})}return{deleteChannel:d,getAllChannels:c}}]),angular.module("intellogoSDK").factory("CategoryService",["$http","$rootScope","API_LOCATION","INTELLOGO_EVENTS","ServiceUtils",function(a,b,c,d,e){function f(b){b=b||{};var c={};b.search&&(c.search=b.search),b.statusFilter&&(c.status=JSON.stringify(b.statusFilter));var d=a.get(e.constructServiceUrl("categories","all",e.constructQueryParameters(c)));return d}function g(b){_.isArray(b)||(b=[b]);var c=e.constructServiceUrl("categories","info");return a.post(c,b)}function h(){return a.get(c+"/api/categories/count")}function i(){return a.get(c+"/api/categories/restrictions")}function j(a){return _.map(a,function(a){return{categoryId:a.categoryId,samples:a.samples||[],testSamples:a.testSamples||[]}})}function k(b){return _.isArray(b)||(b=[b]),a.post(c+"/api/categories/assign",j(b))}function l(b){return _.isArray(b)||(b=[b]),a.post(c+"/api/categories/unassign",j(b))}function m(b){_.isArray(b)||(b=[b]);var d=_.map(b,function(a){return{name:a}});return a.post(c+"/api/categories/create",d)}function n(e){_.isArray(e)||(e=[e]);var f=a.post(c+"/api/categories/update",e);return f.success(function(){b.$broadcast(d.CATEGORY_UPDATED)}),f}function o(b){return _.isArray(b)||(b=[b]),b=_.pluck(b,"categoryId"),a.post(c+"/api/categories/delete",b)}function p(b,d){var f={id:b};return angular.isDefined(d)&&(f.count=d),a.get(c+"/api/categories/contentImages"+e.constructQueryParameters(f))}function q(b,d){return a.post(c+"/api/categories/contents",[{categoryId:b,metadata:!0,collectionName:d}])}function r(b,c){return c=c?c:{},a.post(e.constructServiceUrl("categories","dynamic"),{searchTerm:b,displayName:c.displayName,description:c.description,numResults:c.numResults})}function s(b){return _.isArray(b)||(b=[b]),a.post(c+"/api/categories/invalidate",b)}function t(a,b,c){function d(a){return!a.categoryId}function e(a){a=_.clone(a),delete a.categoryId;var b=!_.find(p,a)&&(a.newContents&&a.newContents.length||a.dirtySamples&&a.dirtySamples.length||a.removedSamples&&a.removedSamples.length);return!!b}function f(a){return{contentId:a._id||a.contentId,positive:a.positive}}function g(a){if(p.length>0){var b=_.pluck(p,"name");m(b).success(function(b){_.each(b,function(a,b){p[b].categoryId=a._id}),a()})}else a()}function h(b){var c=_.filter(a,function(a){return a.newContents&&a.newContents.length||a.newTestContents&&a.newTestContents.length}),d=_.map(c,function(a){var b=_.map(a.newContents,f),c=_.map(a.newTestContents,f);return{categoryId:a.categoryId,samples:b,testSamples:c,invalidate:e(a)}});return d.length?void k(d).success(function(){b()}):void b()}function i(b){var c=_.filter(a,function(a){return a.dirtySamples&&a.dirtySamples.length||a.dirtyTestSamples&&a.dirtyTestSamples.length}),d=_.map(c,function(a){var b=_.map(a.dirtySamples,f),c=_.map(a.dirtyTestSamples,f);return{categoryId:a.categoryId,samples:b,testSamples:c,invalidate:e(a)}});return d.length?void k(d).success(function(){b()}):void b()}function j(b){var c=_.filter(a,function(a){return a.removedSamples&&a.removedSamples.length||a.removedTestSamples&&a.removedTestSamples.length}),d=_.map(c,function(a){var b=_.map(a.removedSamples,f),c=_.map(a.removedTestSamples,f);return{categoryId:a.categoryId,samples:b,testSamples:c,invalidate:e(a)}});return d.length?void l(d).success(function(){b()}):void b()}function o(c){var d=["name","description","autoupdate","displayName","productionReady","locked","useTSVD","tags","keywords","userTrained"],e=_(a).filter(function(a){var c=b[a.categoryId],d=p.indexOf(a)>=0,e=!_.isEqual(a,c);return e||d}).map(function(a){function c(a,b){return _.isEqual(e&&e[b],a)}var e=b[a.categoryId],f=_(a).pick(d).omit(c).value();return _.isEmpty(f)?null:(f.categoryId=a.categoryId,f)}).compact().value();return e.length?void async.each(e,function(a,b){n(a).success(function(){b(null)}).error(function(a){b(a||"Error")})},c):void c()}a||c(new Error("Categories not selected")),_.isArray(a)||(a=[a]);var p=_.filter(a,d);async.series([g,o,h,i,j],_.partial(c,_,p))}return{addNewCategories:m,associateContentsWithCategory:k,deAssociateContentsWithCategory:l,getAllCategories:f,getCategoriesMetadata:g,getCategoryImages:p,getCategoriesCount:h,getCategoriesRestrictions:i,getDynamicCategories:r,expandContentsInCategory:q,removeCategories:o,removeContentsFromCategory:l,saveCategoryChanges:n,saveCategoryDataChanges:t,invalidateCategories:s}}]),angular.module("intellogoSDK").factory("ClientService",["$resource","ServiceUtils",function(a,b){return a(b.constructServiceUrl("clients",":id"),{id:"@_id"},{me:{method:"GET",url:b.constructServiceUrl("clients","me")}})}]),angular.module("intellogoSDK").factory("ContentGroupsService",["$resource","ServiceUtils",function(a,b){return a(b.constructServiceUrl("contentGroups",":id"),{id:"@_id"},{resolveIncludedSources:{method:"GET",url:b.constructServiceUrl("contentGroups","resolved"),isArray:!0,params:{name:[]}}})}]),angular.module("intellogoSDK").factory("ContentService",["$http","ServiceUtils",function(a,b){function c(c,d,e){function f(){var a=e.search;a&&(k.search=a)}function g(){var a=e.source;a&&(k.source=a)}function h(){e.channelId&&e.channelId.length&&(k.metadataFilter||(k.metadataFilter={}),k.metadataFilter.channelId=e.channelId)}function i(){e.acquisitionDate&&(k.metadataFilter||(k.metadataFilter={}),k.metadataFilter.acquisitionDate=e.acquisitionDate)}e=e||{};var j=b.constructServiceUrl("contents","all"),k={from:c,to:d};return f(),g(),h(),i(),j+=b.constructQueryParameters(k),a.get(j)}function d(c,d){return a.post(b.constructServiceUrl("contents/users","update"),{contentId:c,userIds:d})}function e(c){return a.post(b.constructServiceUrl("contents","contentsBySourceId"),{sourceId:c})}function f(c){var d=_.map(c,function(a){return{contentId:a}});return a.post(b.constructServiceUrl("contents/metadata","all"),d)}function g(c){_.isArray(c)||(c=[c]);var d=_.map(c,function(a){return{contentId:a._id}});return a.post(b.constructServiceUrl("contents","delete"),d)}function h(c){var d={contentId:c._id};return a.post(b.constructServiceUrl("contents","deleteTree"),d)}function i(){return a.get(b.constructServiceUrl("contents","sources"))}function j(){return a.get(b.constructServiceUrl("contents","restrictions"))}function k(){return a.get(b.constructServiceUrl("contents","count"))}function l(c){return a.post(b.constructServiceUrl("contents","importArticles"),{dataForImport:c})}function m(c,d){var e=_.clone(d);return e.channel=c,a.post(b.constructServiceUrl("contents","initiateChannelImportTask"),e)}function n(c){return a.get(b.constructServiceUrl("contents","taskStatus"),{params:{taskId:c}})}function o(c){return a.get(b.constructServiceUrl("contents","statusWithPayload"),{params:{timeInterval:c}})}function p(c,d,e){var f={from:c,to:d};return e.search&&(f.search=e.search),e.source&&(f.source=e.source),a.get(b.constructServiceUrl("contents","topLevel")+b.constructQueryParameters(f))}function q(c){var d={contentId:c};return a.get(b.constructServiceUrl("contents","tree")+b.constructQueryParameters(d))}function r(c,d){var e={contentId:c,metadata:d};return a.post(b.constructServiceUrl("contents/tree","metadata"),e)}function s(){return b.constructServiceUrl("contents","importEpub")}function t(){return b.constructServiceUrl("contents","importArticlesXls")}function u(c,d){return a.post(b.constructServiceUrl("contents","ingestedBySource"),{from:Math.floor(d.from/1e3),to:Math.floor(d.to/1e3),sources:c})}function v(c,d){return a.post(b.constructServiceUrl("contents","blacklistedBySource"),{from:Math.floor(d.from/1e3),to:Math.floor(d.to/1e3),sources:c})}return{getAllContentSources:i,getAllContentsInCategories:c,getAllTopLevelContents:p,getContentDescendants:q,getContentsByIds:f,getContentsBySourceId:e,getContentsCount:k,getIngestedContentBySources:u,getBlacklistedContentBySources:v,getContentsRestrictions:j,getEpubImportEndpoint:s,getImportArticlesEndpoint:t,getStatusWithPayload:o,getFullTaskStatus:n,importArticles:l,importCaptions:m,removeContentTree:h,removeContents:g,updateContentTreeMetadata:r,updateContentUsers:d}}]),angular.module("intellogoSDK").factory("IntellogoCredentials",function(){var a,b;return{getOauthClientId:function(){return a},getOauthClientSecret:function(){return b},setClientCredentials:function(c,d){a=c,b=d}}}),angular.module("intellogoSDK").factory("EndpointService",["$resource","ServiceUtils",function(a,b){return a(b.constructServiceUrl("admin","endpoints/:id"),{id:"@_id"},{})}]),angular.module("intellogoSDK").factory("FeedSourcesService",["$http","API_LOCATION",function(a,b){function c(a){return b+"/api/feedSources/"+a}function d(){return a.get(c(""))}function e(b){return a.post(c("add"),b)}function f(b){return a.post(c("update"),b)}function g(b){return a.delete(c(b))}function h(b){return a.post(c("collect"),{url:b})}return{getSources:d,addSource:e,updateSource:f,removeSource:g,collectFeeds:h}}]),angular.module("intellogoSDK").service("FileDownloadDialogService",["UrlUtils","$window",function(a,b){function c(c){b.open(a.addAccessTokenToUrl(c))}return{downloadFileInNewWindow:c}}]),angular.module("intellogoSDK").factory("AuthInterceptor",["UrlUtils","$location","$q","TokenHandler",function(a,b,c,d){return{request:function(b){function c(a){return 0!==a.indexOf("views/")&&a.indexOf(".html")<=0&&a.indexOf(".svg")<=0}return c(b.url)&&(b.url=a.addAccessTokenToUrl(b.url)),b},responseError:function(a){return 401===a.status&&(console.log("Unauthorized, redirecting to login page."),d.resetTokens(),b.path("/login")),c.reject(a)}}}]),angular.module("intellogoSDK").factory("LiveConfigService",["$http","API_LOCATION",function(a,b){function c(){return a.get(b+"/api/admin/config")}function d(c){return a.post(b+"/api/admin/config",c)}function e(){return a.post(b+"/api/admin/config/restoreDefaults")}return{getConfig:c,saveConfig:d,restoreDefaults:e}}]),angular.module("intellogoSDK").factory("LocalStorageBackedVariable",function(){function a(){var a;return{getValue:function(){return a},setValue:function(b){a=b}}}function b(a){return void 0!==a?JSON.stringify(a):""}function c(a){if(a&&""!==a){var b;try{b=JSON.parse(a)}catch(c){b=a}return b}}function d(a){var d=localStorage.getItem(a);return d=c(d),{getValue:function(){return d},setValue:function(c){var e=b(c);b(d)!==e&&localStorage.setItem(a,e),d=c}}}function e(){return window.hasOwnProperty("TEST_MODE")&&window.TEST_MODE}return{createHolder:function(){return e()?a.apply(this,arguments):d.apply(this,arguments)}}}),angular.module("intellogoSDK").factory("RatingService",["$http","ServiceUtils","FileDownloadDialogService",function(a,b,c){function d(a){return b.constructServiceUrl("rating",a)}function e(c,e){if(_.isArray(c))throw new Error("Only one category is supported.");var f={categoryId:c,content:{source:e.source,sourceGroup:e.sourceGroups,acquisitionDate:e.date},runId:e.runId,from:e.from,to:e.to};e.channelId&&e.channelId.length&&(f.content.channelId=e.channelId);var g=d("categoryBest")+b.constructQueryParameters(f);return a.get(g)}function f(a,e){if(_.isArray(a))throw new Error("Only one category is supported.");var f={categoryId:a};e&&(f.source=e);var g=d("categoryBestCSV")+b.constructQueryParameters(f);c.downloadFileInNewWindow(g)}function g(b){_.isArray(b)||(b=[b]);var c=_.map(b,function(a){return{ratingId:a._id}});return a.post(d("delete"),c)}function h(a){var b=a.value||[0,100],c=b[0],d=b[1],e={min:c,max:d};return a.categoryId?e.categoryId=a.categoryId:a.contentId?e.contentId=a.contentId:e={error:"Item doesn't contain any id!"},e}function i(c,d,e,f,g,h){var i=k(c,d,e,f,g,h),j=b.constructServiceUrl("smartFolders","ratings",b.constructQueryParameters(i));return a.get(j)}function j(a,d,e,f,g,h){var i=k(a,d,e,f,g,h),j=b.constructServiceUrl("smartFolders","ratingsCSV",b.constructQueryParameters(i));c.downloadFileInNewWindow(j)}function k(a,b,c,d,e,f){function g(a){var b={};b=_.pick(d,["recommendationSources","sourceGroups","acquisitionDate","channelId"]),b.recommendationSources&&(b.source=b.recommendationSources,delete b.recommendationSources),b.sourceGroups&&(b.sourceGroup=b.sourceGroups,delete b.sourceGroups),_.isEmpty(b)||(a.metadataFilter=b)}var i,j=a._id;if(b)i={smartFolderId:j,useCache:!0,cacheType:c};else{var k=_.map(a.items,h);i={smartFolderItem:k}}return g(i),i.from=e,i.to=f,i}function l(c,d,e,f){var g=k(c,d,e,f),h=b.constructServiceUrl("smartFolders","ratingsCount",b.constructQueryParameters(g));return a.get(h)}function m(c){var d=k(c),e=b.constructServiceUrl("smartFolders","ratingsCountIndividual",b.constructQueryParameters(d));return a.get(e)}function n(c,e,f,g,h){var i={contentId:c};angular.isDefined(e)&&null!==e&&(i.productionReady=e),angular.isNumber(f)&&(i.from=f),angular.isNumber(g)&&(i.to=g),angular.isNumber(h)&&(i.minScore=h);var j=d("contentCategoryRatings")+b.constructQueryParameters(i),k=a.get(j).success(function(a){_.each(a,function(a){a.category&&(a.tags=a.category.tags)})});return k}function o(c,d,e,f){var g={productionReady:f,minScore:e},h=b.constructServiceUrl("rating","contentsCategoryRatingsMap");c?g.profileId=c:g.contentIds=d;var i=a.post(h,g);return i}function p(b){var c=d("contentBest"),e={contentId:b.contentId},f={};return b.recommendationsSource&&(f.source=b.recommendationsSource,_.isArray(b.channelId)&&b.channelId.length&&(f.channelId=b.channelId)),b.acquisitonDate&&(f.acquisitionDate=b.acquisitionDate),b.includeLastRated&&(e.includeLastRated=b.includeLastRated),b.itemsToRate&&(e.itemsToRate=b.itemsToRate),b.from>=0&&b.to>=0&&(e.from=b.from,e.to=b.to),_.isEmpty(f)||(e.contentsToRate=f),a.post(c,e)}function q(c){function e(a){var b={};c.recommendationsSource&&(b.source=c.recommendationsSource),c.recommendationsSourceGroup&&(b.sourceGroup=c.recommendationsSourceGroup),_.isArray(c.channelId)&&c.channelId.length&&(b.channelId=c.channelId),c.recommendationsAcquisitionDate&&(b.acquisitionDate=c.recommendationsAcquisitionDate),_.isEmpty(b)||(a.contentsToRate=b)}var f=d("contentBest"),g={};return c.contentId&&(g.contentId=c.contentId),c.from>=0&&c.to>=0&&(g.from=c.from,g.to=c.to),e(g),c.itemsToRate&&(g.itemsToRate=c.itemsToRate),c.includeLastRated&&(g.includeLastRated=c.includeLastRated),a.get(f+b.constructQueryParameters(g))}function r(c){var e=d("contentBest"),f={contentId:c};return a.delete(e+b.constructQueryParameters(f))}function s(){var b=d("removeAllContentBest");return a.post(b)}function t(b,c){var e=d("categoryToContent"),f={contentIds:b,categoryIds:c};return a.post(e,f)}return{countRatingsForSmartFolder:l,countIndividualRatingsForSmartFolder:m,getCategoryRatingsForContent:n,getCategoryRatingMapForContents:o,getContentRatingsForContent:q,getContentRatingsForContentInitiateTraining:p,getRatings:e,getRatingsAsCSV:f,getRatingsForSmartFolder:i,getRatingsForSmartFolderCSV:j,removeContentRatingsForContent:r,removeAllContentToContentRatings:s,removeRatings:g,getContentRatingsInCategories:t}}]),angular.module("intellogoSDK").service("ReadingProfilesService",["$http","RatingService","ServiceUtils",function(a,b,c){function d(a,b){var c=_.pluck(a.assignedContents,"_id"),d=_.pluck(a.unassignedContents,"_id"),f=_.clone(a),g=_.pick(a,["_id","clientReference","autoupdateCategory","autoupdateCombinations"]);g.contentIdsToAssign=c,g.contentIdsToUnassign=d,e(g).success(function(a){g._id||_.isArray(a)&&a[0]&&(a=a[0],f._id=a._id),b(null,f)}).error(b)}function e(a){return a._id?h(a):(a.contents=a.contentIdsToAssign,delete a.contentIdsToAssign,delete a.contentIdsToUnassign,g(a))}function f(b){return _.isArray(b)||(b=[b]),a.post(c.constructServiceUrl("profiles","remove"),b)}function g(b){return a.post(c.constructServiceUrl("profiles","create"),[b])}function h(b){var d={profileId:b._id,profileData:b};return delete d.profileData._id,a.post(c.constructServiceUrl("profiles","update"),d)}function i(){return a.get(c.constructServiceUrl("profiles","all"))}function j(b,d,e,f){var g={profileId:b,metadata:d,from:e,to:f},h=c.constructServiceUrl("profiles","contents")+c.constructQueryParameters(g);return a.get(h)}function k(a,c,d){var e,f;return a._id?e=a._id:f=_.pluck(a.contents,"_id"),b.getCategoryRatingMapForContents(e,f,c,d)}function l(b,d){d=_.clone(d,!0),b._id?d.profileId=b._id:d.contentIds=_.pluck(b.contents,"_id");var e=c.constructServiceUrl("profiles","categoryCombinations");return a.post(e,d)}function m(b){var d={profileId:b._id},e=c.constructServiceUrl("profiles","contentsCount")+c.constructQueryParameters(d);return a.get(e)}return{saveProfile:d,loadProfiles:i,loadProfileContents:j,getProfileContentsCount:m,analyzeProfile:k,removeProfiles:f,categoryCombinations:l}}]),angular.module("intellogoSDK").factory("RunService",["$http","API_LOCATION","ServiceUtils",function(a,b,c){function d(){return a.get(b+"/api/runs")}function e(c){return a.delete(b+"/api/runs/"+c)}function f(d){return a.get(b+"/api/runs"+c.constructQueryParameters({categoryId:d}))}function g(){return a.get(b+"/api/runs/categoriesWithFinishedRuns")}return{getAllCategoriesWithFinishedRuns:g,getAllRuns:d,getRunsForCategory:f,removeRun:e}}]),angular.module("intellogoSDK").factory("ServiceUtils",["INTELLOGO_API_LOCATION",function(a){function b(a,b){return _.chain(b).map(function(b,e){var f;return f=_.isObject(b)?c(a,b):d(a,b),(0===e?"":"&")+f}).reduce(function(a,b){return a+b}).value()}function c(a,b){return encodeURIComponent(a)+"="+encodeURIComponent(JSON.stringify(b))}function d(a,b){return encodeURIComponent(a)+"="+encodeURIComponent(b)}function e(a,e,f){var g;return g=_.isArray(e)?b(a,e):_.isObject(e)?c(a,e):d(a,e),(f?"?":"&")+g}function f(a){return _.chain(a).pairs().filter(function(a){var b=a[1],c=0===b||!!b,d=_.isArray(b)&&!b.length;return c&&!d}).map(function(a,b){return e.call(this,a[0],a[1],0===b)}).reduce(function(a,b){return a+b},"").value()}function g(b){var c=a,d="/"===c[c.length-1]?c:c+"/",e="/"===b[0]?b.slice(1):b;return d+"api/"+e}function h(a,b,c){var d;return d=b?a+"/"+b:a,g(d)+(c||"")}return{constructQueryParameters:f,constructServiceUrlByPath:g,constructServiceUrl:h}}]),angular.module("intellogoSDK").factory("SmartFoldersService",["$q","$http","$rootScope","ServiceUtils","INTELLOGO_EVENTS",function(a,b,c,d,e){function f(b,c){if(c){var d=a.defer();return d.reject(),d.promise}return a.when(b)}function g(a){return d.constructServiceUrl("smartFolders",a)}function h(a){function b(a){var b={min:a.value[0],max:a.value[1]};return a.categoryId?b.categoryId=a.categoryId:a.contentId?b.contentId=a.contentId:console.error("No id for the item specified!"),b}return _.map(a,function(a){var c={_id:a._id};return a.metadata&&(c.metadata=_.clone(a.metadata)),_.isArray(a.items)&&(c.items=_.map(a.items,b)),c})}function i(a,c){var d=g(),e={categoryId:a};return c&&c.tags&&(e.tags=JSON.stringify(c.tags)),b.get(d,{params:e})}function j(a){var c=g("info");return b.post(c,a)}function k(a){var c=g("image/"+a);return b.get(c)}function l(a){return b.delete(g(a))}function m(a){var d;return a?(Array.isArray(a)||(a=[a]),a=h(a),d=b.post(g("update"),a),d.success(function(){c.$broadcast(e.SMART_FOLDER_UPDATED)})):d=f(null,"No smart folders given."),d}function n(a){Array.isArray(a)||(a=[a]),a=h(a);var d=b.post(g("create"),a);return d.success(function(){c.$broadcast(e.SMART_FOLDER_ADDED)}),d}return{getAllSmartFolders:i,getSmartFoldersById:j,deleteSmartFolder:l,updateSmartFolders:m,addSmartFolder:n,getSmartFolderImage:k}}]),angular.module("intellogoSDK").factory("SystemTasksService",["$http","API_LOCATION","ServiceUtils",function(a,b,c){function d(){return o}function e(b){return b.endpoint?a.post(c.constructServiceUrl("/admin/system",b.endpoint)):void console.log("Could not initialize unknown system task "+b)}var f={id:"system-categories-update",name:"Insights Update",endpoint:"initiateCategoriesUpdate"},g={id:"system-smart-folder-cache-update",name:"Smart Collections Cache Update",endpoint:"initiateSmartFoldersCacheUpdate"},h={id:"system-smart-folder-contents-update",name:"Smart Collections Contents Update",endpoint:"initiateSmartFolderContentsUpdate"},i={id:"system-rss-ingestion",name:"RSS Ingestion",endpoint:"initiateRssIngestion"},j={id:"system-content-cleanup",name:"Content Cleanup",endpoint:"initiateContentCleanup"},k={id:"system-profiles-update",name:"Profiles Update",endpoint:"initiateProfilesUpdate"},l={id:"system-channels-update",name:"Youtube Channels Update",endpoint:"initiateYoutubeChannelsUpdate"},m={id:"system-dynamic-categories-cleanup",name:"Dynamic Insights Cleanup",endpoint:"initiateDynamicInsightsCleanup"},n={id:"all-sources-cleanup-task",name:"Rss Content Cleanup",endpoint:"cleanStaleContent"},o=[f,i,h,g,k,j,l,m,n];return{getSystemTaskTypes:d,initiateSystemTask:e}}]),angular.module("intellogoSDK").factory("TokenHandler",["LocalStorageBackedVariable","IntellogoCredentials",function(a,b){function c(a){return SparkMD5.hash(b.getOauthClientId()+"."+a)}function d(b){var d=c(b);return o[d]=o[d]||a.createHolder(d),o[d].getValue()}function e(b,d){var e=c(b);o[e]=o[e]||a.createHolder(e),o[e].setValue(d)}function f(){return d(l)}function g(a){e(l,a)}function h(){return d(m)}function i(a){e(m,a)}function j(){return d(n)}function k(a){e(n,a)}var l="access_token",m="token_expiration",n="refresh_token",o={};return{setToken:g,setTokenExpiration:i,getTokenExpiration:h,setRefreshToken:k,getToken:f,getRefreshToken:j,resetTokens:function(){g(null),k(null),i(0)}}}]),angular.module("intellogoSDK").factory("TrainingService",["$http","ServiceUtils",function(a,b){function c(c,d,e){var f={categoryId:c};return d&&(_.isArray(d)||(d=[d]),f.contentSource=d),e&&(f.combinations=e),a.post(b.constructServiceUrl("trainings","initiate"),f)}function d(c,d,e){var f={timeInterval:c,includeTaskResults:!!e};return _.isArray(d)&&d.length>0&&(f.taskTypes=d),a.get(b.constructServiceUrl("trainings","status"),{params:f})}function e(c){return a.get(b.constructServiceUrl("trainings","taskStatus"),{params:{taskId:c}})}function f(c,d){var e,f=b.constructServiceUrl("trainings","cancel"),g={taskId:c};return d&&(g.requestId=d),e={taskIds:[g]},a.post(f,e)}return{cancelTask:f,getStatus:d,getTaskStatusById:e,initiateTraining:c}}]),angular.module("intellogoSDK").factory("TrainingSetService",["$http","API_LOCATION","ServiceUtils",function(a,b,c){function d(){var c=b+"/api/trainingSets/all";return a.get(c)}function e(d){var e=b+"/api/trainingSets/generate"+c.constructQueryParameters({categoryId:d});return a.post(e)}return{generateTrainingSets:e,getAllTrainingSets:d}}]),angular.module("intellogoSDK").factory("UrlUtils",["TokenHandler",function(a){function b(b){var c=b.indexOf("?")>0?"&":"?",d=a.getToken();return d?b+c+"access_token="+d:b}return{addAccessTokenToUrl:b}}]),angular.module("intellogoSDK").factory("UserDataHandler",["LocalStorageBackedVariable",function(a){var b=a.createHolder("content_sources"),c=a.createHolder("default_source"),d=a.createHolder("categories"),e=a.createHolder("user_type"),f=a.createHolder("image_path"),g=a.createHolder("eula_accepted");return{setContentSourcesRestriction:b.setValue,getContentSourcesRestriction:b.getValue,setDefaultSource:c.setValue,getDefaultSource:c.getValue,setCategoriesRestriction:d.setValue,getCategoriesRestriction:d.getValue,setUserImagePath:f.setValue,getUserImagePath:f.getValue,setUserType:e.setValue,getUserType:e.getValue,setEULAAccepted:g.setValue,getEULAAccepted:g.getValue,resetValues:function(){e.setValue(null),b.setValue([]),d.setValue([]),c.setValue(null),f.setValue(null)}}}]),angular.module("intellogoSDK").factory("UserDataService",["$http","$q","UserDataHandler","API_LOCATION",function(a,b,c,d){function e(){var e=b.defer(),f=a.get(d+"/api/currentUser/info");return f.success(function(a){c.setUserType(a.userType),c.setContentSourcesRestriction(a.sourcesRestriction),c.setDefaultSource(a.defaultSource),c.setCategoriesRestriction(a.categoriesRestriction),c.setUserImagePath(a.image),e.resolve()}),f.error(function(a){e.reject(a)}),e.promise}function f(){c.resetValues()}return{loadUserData:e,resetUserData:f}}]),angular.module("intellogoSDK").factory("UsersService",["$http","ServiceUtils",function(a,b){function c(c){var d=b.constructServiceUrl("users","all",b.constructQueryParameters({search:c}));return a.get(d)}function d(c){var d=b.constructServiceUrl("users","all",b.constructQueryParameters({userIds:c}));return a.get(d)}return{getUsersByUsername:c,getUsersByIds:d}}]),angular.module("intellogoSDK").factory("VersionService",["$http","$q","API_LOCATION",function(a,b,c){function d(){var d=b.defer();if(e)setTimeout(function(){d.resolve(e)},0);else{var f=a({url:c+"/version",method:"GET",transformResponse:[function(a){return a}]});f.success(function(a){e=a,d.resolve(e)}),f.error(function(a){d.reject(a)})}return d.promise}var e;return{getVersion:d}}]);